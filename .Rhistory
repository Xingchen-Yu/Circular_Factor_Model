dup_list$H116 %>% group_by(bioname) %>%
pivot_wider(names_from = bioname,values_from=name_district)
dup_list$H116 %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district)
dup_list$H116 %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = name_district,values_from=bioname)
dup_list$H116 %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district)
dup_list$H116 %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district) %>% select(-row)
lapply(dup_list,function(x) x %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district) %>% select(-row))
dup_list_pivot = lapply(dup_list,function(x) x %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district) %>% select(-row))
dup_list_pivot
dup_list
str_sub
dup_list$name_district =
gsub(".*(",dup_list$name_district)
dup_list$name_district =
gsub(".*(","",dup_list$name_district)
gsub
dup_list$name_district =
gsub(".*\(","",dup_list$name_district)
dup_list$name_district =
gsub(".*\\(","",dup_list$name_district)
dup_list$name_district
dup_list
gsub(".*\\(","",dup_list$name_district)
dup_list$name_district
dup_list
gsub(".*\\(","",dup_list$H116$name_district)
gsub("\\)","",gsub(".*\\(","",dup_list$H116$name_district))
lapply(dup_list,function(x) x$name_district = gsub("\\)","",gsub(".*\\(","",x$name_district)))
house_list = c(100:116)
dup_list = vector('list',17)
for(i in 1:17){
cat("\rProgress: ",i,"/",17)
house_number = house_list[i]
c1 = congress_member %>% filter(congress == house_number) %>% select(party_code,icpsr,bioname,state_abbrev,district_code) %>%
mutate(party = case_when(party_code == 100~'D',party_code == 200~'R',party_code==328~'I')) %>%
mutate(name_district  = paste0(bioname," (",party,' ',state_abbrev,"-",district_code,")")) %>%
select(icpsr,name_district,bioname)
c2= congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number) %>%
mutate(cast_code = case_when(cast_code %in% c(1:3) ~ 1, cast_code %in% c(4:6) ~0,TRUE~NA_real_)) %>%
pivot_wider(names_from = rollnumber, values_from = cast_code) %>% select(-congress)
c3 = c2 %>% left_join(c1,by = "icpsr")
dup_list[[i]] = c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
dup_list[[i]]$name_district = gsub("\\)","",gsub(".*\\(","",dup_list[[i]]$name_district))
rm(c1)
rm(c2)
rm(c3)
}
names(dup_list) = paste0('H',100:116)
dup_list_pivot = lapply(dup_list,function(x) x %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district) %>% select(-row))
dup_list_pivot
dup_list_pivot$H104
dup_list$H104
names(dup_list_pivot$H104)
dup_list_pivot$H104
dup_list_pivot
congress_all %>% glimpse()
congress_member %>% glimpse()
###############################
h116 = congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == 116) %>%
mutate(cast_code = case_when(cast_code %in% c(1:3) ~ 1, cast_code %in% c(4:6) ~0,TRUE~NA_real_)) %>%
pivot_wider(names_from = rollnumber, values_from = cast_code) %>% select(-congress)
h116 %>% select(rollnumber)
h116 %>% select(rollnumber)
h116
congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == 116) %>%  %>% select(rollnumber)
congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == 116) %>%
select(rollnumber)
congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == 116) %>%
summarise(count = n_distinct(rollnumber))
H116_bills = read_csv('./data/H116_rollcalls.csv',guess_max =20000)
H116_bills %>% glimpse()
H116_bills$bill_number
h116
apply(h116 %>% select(-icpsr),1,sum)
apply(h116 %>% select(-icpsr),1,function(x) sum(x,na.rm=T))
h116
apply(h116 %>% select(-icpsr),2,function(x) sum(x,na.rm=T))
apply(h116 %>% select(-icpsr),2,function(x) sum(x,na.rm=T)) $values
apply(h116 %>% select(-icpsr),2,function(x) sum(x,na.rm=T))$values
str(apply(h116 %>% select(-icpsr),2,function(x) sum(x,na.rm=T)))
apply(h116 %>% select(-icpsr),2,function(x) sum(x,na.rm=T)) == H116_bills$yea_count
h116 %>% select(-icpsr) %>% summarise(count = sum)
h116 %>% select(-icpsr) %>% summarise(across(everything(),sum))
h116 %>% select(-icpsr) %>% summarise(across(everything(),function(x) sum(x,na.rm = T)))
h116 %>% select(-icpsr) %>% summarise(across(everything(),function(x) sum(x,na.rm = T)))
h116 %>% select(-icpsr) %>% summarise(across(everything(),function(x) sum(x,na.rm = T)))[1,]
temp = h116 %>% select(-icpsr) %>% summarise(across(everything(),function(x) sum(x,na.rm = T)))
temp[1,]
str(temp)
unlist(temp)
unlist(temp) == H116_bills$yea_count
all_equal(unlist(temp),H116_bills$yea_count)
all_equal
all_equal(unlist(temp),H116_bills$yea_count)
unlist(temp)
str(unlist(temp))
str(H116_bills$yea_count)
c(unlist(temp))
as.numeric(unlist(temp))
all_equal(as.numeric(unlist(temp)),H116_bills$yea_count)
all_equal
near(as.numeric(unlist(temp)),H116_bills$yea_count)
temp2= h116 %>% select(-icpsr) %>% summarise(across(everything(),function(x) length(which(is.na(x)==T))))
temp2
temp2= h116 %>% select(-icpsr) %>% summarise(across(everything(),function(x) length(which(x==0))))
near(as.numeric(unlist(temp2)),H116_bills$nay_count)
congress_bills = read_csv('./data/Hall_rollcalls.csv',guess_max = 20000)
congress_bills
congress_bills = read_csv('./data/Hall_rollcalls.csv',guess_max = 20000,col_types = col(session = col_character(),
clear_roll_number = col_character(),vote_result = col_character(),vote_question = col_character()))
congress_bills = read_csv('./data/Hall_rollcalls.csv',guess_max = 20000,col_types = cols(session = col_character(),
clear_roll_number = col_character(),vote_result = col_character(),vote_question = col_character()))
congress_bills = read_csv('./data/Hall_rollcalls.csv',guess_max = 20000,col_types = cols(session = col_character(),
clerk_roll_number = col_character(),vote_result = col_character(),vote_question = col_character()))
congress_bills = read_csv('./data/Hall_rollcalls.csv',guess_max = 20000,col_types = cols(session = col_character(),
clerk_rollnumber = col_character(),vote_result = col_character(),vote_question = col_character()))
congress_bills = read_csv('./data/Hall_rollcalls.csv',guess_max = 20000,col_types = cols(session = col_character(),
clerk_rollnumber = col_character(),vote_result = col_character(),vote_question = col_character(),vote_desc = col_character()))
c2
house_number = house_list[i]
c1 = congress_member %>% filter(congress == house_number) %>% select(party_code,icpsr,bioname,state_abbrev,district_code) %>%
mutate(party = case_when(party_code == 100~'D',party_code == 200~'R',party_code==328~'I')) %>%
mutate(name_district  = paste0(bioname," (",party,' ',state_abbrev,"-",district_code,")")) %>%
select(icpsr,name_district,bioname)
c2= congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number) %>%
mutate(cast_code = case_when(cast_code %in% c(1:3) ~ 1, cast_code %in% c(4:6) ~0,TRUE~NA_real_)) %>%
pivot_wider(names_from = rollnumber, values_from = cast_code) %>% select(-congress)
c2
c3 = c2 %>% left_join(c1,by = "icpsr")
c3
c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) sum(x,na.rm = T)))
congress_bills %>% filter(congress == house_number)
near(as.numeric(unlist(temp)),c_bills$yea_count)
c_bills = congress_bills %>% filter(congress == house_number)
near(as.numeric(unlist(temp)),c_bills$yea_count)
sum(near(as.numeric(unlist(temp)),c_bills$yea_count)) == length(temp)
length(temp)
temp2 = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) length(which(x==0))))
temp2
t2 = sum(near(as.numeric(unlist(temp2)),c_bills$nay_count)) == length(temp)
t2
sum(near(as.numeric(unlist(temp2)),c_bills$nay_count))
c_bills$nay_count
as.numeric(unlist(temp2))
house_list = c(100:116)
dup_list = yes_no_list = vector('list',17)
for(i in 1:17){
cat("\rProgress: ",i,"/",17)
house_number = house_list[i]
c1 = congress_member %>% filter(congress == house_number) %>% select(party_code,icpsr,bioname,state_abbrev,district_code) %>%
mutate(party = case_when(party_code == 100~'D',party_code == 200~'R',party_code==328~'I')) %>%
mutate(name_district  = paste0(bioname," (",party,' ',state_abbrev,"-",district_code,")")) %>%
select(icpsr,name_district,bioname)
c2= congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number) %>%
mutate(cast_code = case_when(cast_code %in% c(1:3) ~ 1, cast_code %in% c(4:6) ~0,TRUE~NA_real_)) %>%
pivot_wider(names_from = rollnumber, values_from = cast_code) %>% select(-congress)
c_bills = congress_bills %>% filter(congress == house_number)
temp = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) sum(x,na.rm = T)))
t1 = sum(near(as.numeric(unlist(temp)),c_bills$yea_count)) == length(temp)
temp2 = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) length(which(x==0))))
t2 = sum(near(as.numeric(unlist(temp2)),c_bills$nay_count)) == length(temp)
yes_no_list[[i]] = c(t1,t2)
c3 = c2 %>% left_join(c1,by = "icpsr")
dup_list[[i]] = c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
dup_list[[i]]$name_district = gsub("\\)","",gsub(".*\\(","",dup_list[[i]]$name_district))
rm(c1)
rm(c2)
rm(c3)
rm(c_bills)
rm(t1)
rm(t2)
rm(temp2)
rm(temp)
}
names(dup_list) = paste0('H',100:116)
dup_list_pivot = lapply(dup_list,function(x) x %>% group_by(bioname) %>% mutate(row = row_number()) %>%
pivot_wider(names_from = bioname,values_from=name_district) %>% select(-row))
names(dup_list_pivot$H104)
dup_list_pivot
yes_no_list
names(dup_list) = names(yes_no_list) = paste0('H',100:116)
yes_no_list
i = 16
house_number = house_list[i]
c1 = congress_member %>% filter(congress == house_number) %>% select(party_code,icpsr,bioname,state_abbrev,district_code) %>%
mutate(party = case_when(party_code == 100~'D',party_code == 200~'R',party_code==328~'I')) %>%
mutate(name_district  = paste0(bioname," (",party,' ',state_abbrev,"-",district_code,")")) %>%
select(icpsr,name_district,bioname)
c2= congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number) %>%
mutate(cast_code = case_when(cast_code %in% c(1:3) ~ 1, cast_code %in% c(4:6) ~0,TRUE~NA_real_)) %>%
pivot_wider(names_from = rollnumber, values_from = cast_code) %>% select(-congress)
c_bills = congress_bills %>% filter(congress == house_number)
temp = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) sum(x,na.rm = T)))
t1 = sum(near(as.numeric(unlist(temp)),c_bills$yea_count)) == length(temp)
t1
near(as.numeric(unlist(temp))
)
as.numeric(unlist(temp))
c_bills$yea_count)
c_bills$yea_count
###
as.numeric(unlist(temp)) - c_bills$yea_count
###
which((as.numeric(unlist(temp)) - c_bills$yea_count)!=0)
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count)
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% filter(value!=0)
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% filter(value!=0) %>% print(n=Inf)
t2
###
temp2 = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) length(which(x==0))))
t2 = sum(near(as.numeric(unlist(temp2)),c_bills$nay_count)) == length(temp)
t2
###H115 anomaly
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf)
c2
c1
c2
c2 %>% select(1)
c2 %>% select(2)
c1
congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number)
congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number) %>%
###
temp2 = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) length(which(x==0))))
congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c(rollnumber) )
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") )
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") )
pivot_wider
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress) %>% pivot_wider(values_from = cast_code,names_from =roll_number)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress) %>% pivot_wider(values_from = cast_code,names_from =rollnumber)
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") )
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress) %>% group_by(rollnumber) %>% pivot_wider(values_from = cast_code,names_from =rollnumber)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress) %>% group_by(rollnumber)  %>% mutate(row = row_number())%>%
pivot_wider(values_from = cast_code,names_from =rollnumber)
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>%
pivot_wider(values_from = cast_code,names_from =rollnumber)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress) %>% group_by(rollnumber)  %>% mutate(row = row_number())%>%
pivot_wider(values_from = cast_code,names_from =rollnumber)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-value,-icpsr,-congress)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = rollnumber,values_from = n)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf)
c_bills$yea_count
as.numeric(unlist(temp))
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% mutate(yea_count = c_bills$yea_count)
c_bills$yea_count[c(64,71,72)]
c_bills
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills,by=c(rollnumber,yea_count))
c_bills
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c(rollnumber))
c_bills %>%
select(rollnumber,yea_count)
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(.,c_bills %>%
select(rollnumber,yea_count),by=c(rollnumber))
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber"))
###H115 anomaly for yes_no_list
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf)
c2
c1
c2 %>% filter(icpsr==99912)
c2 %>% filter(icpsr==99912) %>% pivot_longer()
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything())
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything()) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything(),values_to=icpsr) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything(),values_to="icpsr") %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything(),names_to="icpsr") %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything(),names_to=icpsr) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything()) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything()) %>% count(value) %>%
sdf
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=everything()) %>% count(value)
c2 %>% filter(icpsr ==99912)
c1
c2 %>% filter(icpsr==99912) %>% pivot_longer(!=icpsr,cols=everything()) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(!=icpsr) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(!icpsr,cols=everything()) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% count(value)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(name='rollnumber')
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(name=rollnumber)
c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>% select(-icpsr) %>%
by=rollnumber)
###H115 anomaly for yes_no_list, after checking,
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>% select(-icpsr) %>%
by=c("rollnumber"))
###H115 anomaly for yes_no_list, after checking,
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>% select(-icpsr),
by=c("rollnumber"))
###H115 anomaly for yes_no_list, after checking,
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>%
mutate(rollnumber = as.numeric(rollnumber) )%>% select(-icpsr),
by=c("rollnumber"))
###H115 anomaly for yes_no_list, after checking,
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>%
mutate(rollnumber = as.numeric(rollnumber) )%>% select(-icpsr),
by=c("rollnumber")) %>% print(n = Inf)
###H115 anomaly for yes_no_list, after checking, it's trump's votes! 99912 is trump
trump = as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>%
mutate(rollnumber = as.numeric(rollnumber) )%>% select(-icpsr),
by=c("rollnumber")) %>% print(n = Inf)
trump %>% mutate(corrected_yea = yea_count - value) %>% mutate(check = `1`==corrected_yea)
rm(trump)
###H115 anomaly for yes_no_list, after checking, it's trump's votes! 99912 is trump
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>%
mutate(rollnumber = as.numeric(rollnumber) )%>% select(-icpsr),
by=c("rollnumber")) %>% trump %>% mutate(corrected_yea = yea_count + value) %>%
mutate(check = `1`==corrected_yea)%>% print(n = Inf)
###H115 anomaly for yes_no_list, after checking, it's trump's votes! 99912 is trump
as_tibble(as.numeric(unlist(temp)) - c_bills$yea_count) %>% mutate(rollnumber=c_bills$rollnumber) %>%
filter(value!=0) %>% print(n=Inf) %>% inner_join(  congress_all %>% select(icpsr,cast_code,congress,rollnumber)
%>% filter(congress == house_number),by=c("rollnumber") ) %>%
select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>%
mutate(rollnumber = as.numeric(rollnumber) )%>% select(-icpsr),
by=c("rollnumber")) %>% mutate(corrected_yea = yea_count + value) %>%
mutate(check = `1`==corrected_yea)%>% print(n = Inf)
c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
c3 = c2 %>% left_join(c1,by = "icpsr")
dup_list[[i]] = c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
i = 17
house_number = house_list[i]
c1 = congress_member %>% filter(congress == house_number) %>% select(party_code,icpsr,bioname,state_abbrev,district_code) %>%
mutate(party = case_when(party_code == 100~'D',party_code == 200~'R',party_code==328~'I')) %>%
mutate(name_district  = paste0(bioname," (",party,' ',state_abbrev,"-",district_code,")")) %>%
select(icpsr,name_district,bioname)
c2= congress_all %>% select(icpsr,cast_code,congress,rollnumber) %>% filter(congress == house_number) %>%
mutate(cast_code = case_when(cast_code %in% c(1:3) ~ 1, cast_code %in% c(4:6) ~0,TRUE~NA_real_)) %>%
pivot_wider(names_from = rollnumber, values_from = cast_code) %>% select(-congress)
c_bills = congress_bills %>% filter(congress == house_number)
temp = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) sum(x,na.rm = T)))
t1 = sum(near(as.numeric(unlist(temp)),c_bills$yea_count)) == length(temp)
#                                                      %>% filter(congress == house_number),by=c("rollnumber") ) %>%
#   select(-icpsr,-congress) %>% group_by(rollnumber) %>% count(cast_code) %>%
#   pivot_wider(names_from = cast_code,values_from = n) %>% print(n = Inf) %>% inner_join(c_bills %>%
#                                     select(rollnumber,yea_count),by=c("rollnumber")) %>% print(n=Inf) %>%
# inner_join(c2 %>% filter(icpsr==99912) %>% pivot_longer(cols=-icpsr) %>% rename(rollnumber = name) %>%
#              mutate(rollnumber = as.numeric(rollnumber) )%>% select(-icpsr),
#  by=c("rollnumber")) %>% mutate(corrected_yea = yea_count + value) %>%
#   mutate(check = `1`==corrected_yea)%>% print(n = Inf)
#
###
temp2 = c2 %>%select(-icpsr) %>%  summarise(across(everything(),function(x) length(which(x==0))))
t2 = sum(near(as.numeric(unlist(temp2)),c_bills$nay_count)) == length(temp)
yes_no_list[[i]] = c(t1,t2)
c3 = c2 %>% left_join(c1,by = "icpsr")
dup_list[[i]] = c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
dup_list[[i]]$name_district = gsub("\\)","",gsub(".*\\(","",dup_list[[i]]$name_district))
c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
c3
dup_list_pivot
c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1) %>%
select(bioname,name_district) %>% arrange(desc(name_district))
c3 %>% group_by(bioname) %>%  mutate(n = n()) %>% filter(n>1)
